<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Painel — Saúde Bucal Japeri</title>
... (restante do head e styles) ...
</head>
<body>
  <div class="wrap">
... (restante do header e main) ...
    <footer class="footer">
      <img src="japeri-logo.png" alt="Japeri">
      <div class="muted">Prefeitura de Japeri — Saúde Bucal</div>
    </footer>
  </div>

  <div id="drawerOverlay" aria-hidden="true"></div>
  <aside id="sideDrawer" class="side-drawer" aria-hidden="true" role="dialog" aria-label="Opções do site">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
      <strong>Opções</strong>
      <button id="drawerClose" style="margin-left:auto;padding:6px;border-radius:8px;border:1px solid var(--line);background:#fff;cursor:pointer">Fechar</button>
    </div>
    <nav>
      <a class="drawer-item" href="index.html">Início</a>
      <a class="drawer-item" href="avisos.html">Avisos</a>
      <a class="drawer-item" href="painel.html">Painel</a>
      <hr>
      <button id="refreshDataBtn" class="drawer-item" style="background:transparent;border:0;text-align:left;cursor:pointer">Atualizar dados</button>
    </nav>
  </aside>

  <script>
    (function(){
      const $ = s=>document.querySelector(s);
      const elPosto = $('#postoSelect'), elMes = $('#mesSelect'), elBtn = $('#refreshBtn');
      const elPPosto = $('#pillPosto'), elPMes = $('#pillMes'), elPStamp = $('#pillStamp');
      const elFilaMes = $('#filaMes'), elFilaMesObs = $('#filaMesObs');
      const elPostoAcum = $('#postoAcumFila'), elPostoAcumObs = $('#postoAcumFilaObs');
      const elGeralAcum = $('#geralAcumFila'); const elAgTotal = $('#agTotal'); const elResumo = $('#postoResumo');
      const elErr = $('#error');
      let DATA = null;
      const nomes=["","jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"];
      function parseRank(k){
        const m=/^(\d{4})-(\d{2})(?:-(\d{2}))?$/.exec(k);
        if(m){const y=+m[1], m1=+m[2], m2=m[3]?+m[3]:null;return y*12+m1+(m2?0.5:0);}
        const s=k.toLowerCase();
        if(/fev/.test(s))return 2; if(/mar/.test(s))return 3; if(/mai/.test(s))return 5;
        if(/jun/.test(s))return 6; if(/jul.*ago|jul\/ago|jul-ago/.test(s))return 7.5;
        if(/ago/.test(s))return 8; if(/set/.test(s))return 9; return 0;
      }
      function labelMes(k){
        const m=/^(\d{4})-(\d{2})(?:-(\d{2}))?$/.exec(k);
        if(m){const y=m[1], m1=+m[2], m2=m[3]?+m[3]:null;return m2?`${nomes[m1]}+${nomes[m2]}/${y}`:`${nomes[m1]}/${y}`;}
        return k;
      }
      function stamp(iso){ try{const d=new Date(iso);const two=n=>String(n).padStart(2,'0');return `${two(d.getDate())}/${two(d.getMonth()+1)}/${d.getFullYear()} ${two(d.getHours())}:${two(d.getMinutes())}`;}catch{return '—'} }
      function animate(el,to){ const from=Number(el.textContent.replace(/\D/g,''))||0; const target=Number(to)||0; const diff=target-from; const steps=12;
        if(diff===0){el.textContent=String(target);return;}
        let i=0; const tick=()=>{ i++; el.textContent=String(Math.round(from+diff*(i/steps))); if(i<steps) requestAnimationFrame(tick); }; requestAnimationFrame(tick);
      }
      function getPostos(){ return Object.keys(DATA.postos||{}).sort((a,b)=>a.localeCompare(b,'pt')); }
      function getMeses(){ const set=new Set(); for(const p of Object.values(DATA.postos||{})) for(const k of Object.keys(p)) set.add(k); return [...set].sort((a,b)=>parseRank(b)-parseRank(a)); }
      function somaPostoMes(p,m){ return Number((DATA.postos?.[p]||{})[m]?.fila||0); }
      function somaMesFila(m){ let t=0; for(const p of Object.keys(DATA.postos||{})) t+=somaPostoMes(p,m); return t; }
      function somaPostoTodos(p){ let t=0; for(const k of Object.keys(DATA.postos?.[p]||{})) t+=Number(DATA.postos[p][k].fila||0); return t; }
      function somaGeralFila(){ let t=0; for(const p of Object.keys(DATA.postos||{})) t+=somaPostoTodos(p); return t; }
      function populaFiltros(){
        elPosto.innerHTML=''; const optAll=document.createElement('option'); optAll.value='__ALL__'; optAll.textContent='Todos os postos'; elPosto.appendChild(optAll);
        for(const p of getPostos()){ const o=document.createElement('option'); o.value=p; o.textContent=p; elPosto.appendChild(o); }
        elMes.innerHTML=''; for(const m of getMeses()){ const o=document.createElement('option'); o.value=m; o.textContent=labelMes(m); elMes.appendChild(o); }
        const hash=new URLSearchParams(location.hash.replace(/^#/,'')); const hp=hash.get('posto'), hm=hash.get('mes');
        elPosto.value=(hp && (hp==='__ALL__' || getPostos().includes(hp)))?hp:'__ALL__';
        elMes.value=(hm && getMeses().includes(hm))?hm:(getMeses()[0]||'');
        atualizaChips();
      }
      function atualizaChips(){ elPPosto.textContent='Posto: '+(elPosto.value==='__ALL__'?'Todos':elPosto.value); elPMes.textContent='Mês: '+labelMes(elMes.value||'—'); elPStamp.textContent='Atualizado: '+(DATA?.atualizado_em?stamp(DATA.atualizado_em):'—'); const p=new URLSearchParams(); p.set('posto',elPosto.value); p.set('mes',elMes.value); history.replaceState(null,'','#'+p.toString()); }
      function render(){
        elErr.style.display='none';
        const posto=elPosto.value, mes=elMes.value;
        animate(elGeralAcum, somaGeralFila());
        animate(elAgTotal, Number(DATA.agendados_total || 0));
        if(!mes){ elFilaMes.textContent='0'; elFilaMesObs.textContent='Selecione um mês.'; elPostoAcum.textContent='—'; elPostoAcumObs.textContent='Selecione um posto.'; return; }
        const filaMes = (posto==='__ALL__') ? somaMesFila(mes) : somaPostoMes(posto, mes);
        animate(elFilaMes, filaMes);
        elFilaMesObs.textContent = (posto==='__ALL__') ? 'Somando todos os postos neste mês.' : 'Total deste posto no mês escolhido.';
        if(posto==='__ALL__'){ elPostoAcum.textContent='—'; elPostoAcumObs.textContent='Escolha um posto para ver o total dele.'; } else {
          const a = somaPostoTodos(posto);
          animate(elPostoAcum, a);
          elPostoAcumObs.textContent='Somando todos os meses registrados para este posto.';
        }
        const arr = Object.keys(DATA.postos||{}).map(p=>[p,somaPostoTodos(p)]).sort((a,b)=>b[1]-a[1]);
        elResumo.innerHTML='';
        for(const [name,total] of arr){
          const row=document.createElement('div'); row.className='row'; row.innerHTML=`<b>${name}</b><span>${total}</span>`; elResumo.appendChild(row);
        }
      }
      async function loadData(){
        try{
          elErr.style.display='none';
          const res = await fetch('data.json?cb='+Date.now());
          if(!res.ok) throw new Error('HTTP '+res.status);
          const txt = await res.text();
          try{ DATA = JSON.parse(txt); }catch(e){ throw new Error('JSON inválido: '+e.message); }
          populaFiltros(); render();
        }catch(e){
          elErr.textContent='Não foi possível carregar os dados. Veja se o "data.json" está na mesma pasta. Detalhe: '+e.message; elErr.style.display='block';
        }
      }
      elPosto.addEventListener('change', ()=>{ atualizaChips(); render(); });
      elMes.addEventListener('change',   ()=>{ atualizaChips(); render(); });
      elBtn.addEventListener('click', loadData);
      window.loadData = loadData;
      loadData();
      setInterval(loadData, 60000);
    })();
  </script>

  <script>
    (function(){
      const drawer = document.getElementById("sideDrawer");
      const drawerToggle = document.getElementById("drawerToggle");
      const drawerClose = document.getElementById("drawerClose");
      const overlay = document.getElementById("drawerOverlay");

      function openDrawer() {
        drawer?.classList.add("open");
        overlay?.style.setProperty('display', 'block');
        document.body.style.overflow = 'hidden';
      }

      function closeDrawer() {
        drawer?.classList.remove("open");
        overlay?.style.setProperty('display', 'none');
        document.body.style.overflow = '';
      }

      drawerToggle?.addEventListener("click", openDrawer);
      drawerClose?.addEventListener("click", closeDrawer);
      overlay?.addEventListener("click", closeDrawer);

      /* Fechar com tecla ESC */
      document.addEventListener("keydown", e => {
        if (e.key === "Escape" && drawer?.classList.contains('open')) closeDrawer();
      });

      /* Fechar ao clicar em item de navegação */
      drawer?.addEventListener('click', function(e){
        const item = e.target.closest('.drawer-item');
        if(!item) return;
        setTimeout(()=> closeDrawer(), 120);
      });
      
      // Conecta o botão de atualizar à função loadData do Painel
      const refreshDataBtn = document.getElementById('refreshDataBtn');
      if(refreshDataBtn && window.loadData) refreshDataBtn.addEventListener('click', window.loadData);
    })();
  </script>
</body>
</html>
